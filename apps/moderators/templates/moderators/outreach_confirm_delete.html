{% extends 'base.html' %}
{% load static %}

{% block title %}Delete Outreach Post - CommuMap{% endblock %}

{% block extra_css %}
<style>
    .warning-theme {
        --primary-color: #f59e0b;
        --primary-hover: #d97706;
        --accent-color: #fbbf24;
    }
    
    .delete-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border-left: 6px solid #ef4444;
    }
    
    .danger-zone {
        background: linear-gradient(135deg, #fef2f2, #fee2e2);
        border: 2px solid #fecaca;
        border-radius: 12px;
        padding: 2rem;
    }
    
    .post-preview {
        background: #f9fafb;
        border-radius: 8px;
        padding: 1.5rem;
        border-left: 4px solid #d1d5db;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-base-100">
    <!-- Header -->
    <div class="bg-error text-error-content p-6 mb-6">
        <div class="container mx-auto">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold">‚ö†Ô∏è Delete Outreach Post</h1>
                    <p class="text-lg opacity-90">Confirm permanent deletion of outreach content</p>
                </div>
                <div class="flex gap-3">
                    <a href="{% url 'moderators:outreach_detail' object.pk %}" class="btn btn-outline btn-error">
                        ‚Üê Back to Post
                    </a>
                    <a href="{% url 'moderators:outreach' %}" class="btn btn-outline btn-error">
                        All Posts
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-6">
        <!-- Warning Alert -->
        <div class="alert alert-error mb-8">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3.75m-9 0 0 0a9 9 0 0118 0a9 9 0 01-18 0zm-9 3.75h.008v.008H12V13z" />
            </svg>
            <div>
                <h3 class="font-bold text-lg">This action cannot be undone!</h3>
                <div class="text-sm">
                    Deleting this outreach post will permanently remove it from the system. 
                    All engagement data will be lost and users will no longer be able to view this content.
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Card -->
        <div class="delete-card p-8">
            <!-- Post Preview -->
            <div class="mb-8">
                <h2 class="text-2xl font-bold mb-4">Post to be Deleted</h2>
                <div class="post-preview">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex-1">
                            <h3 class="text-xl font-semibold mb-2">{{ object.title }}</h3>
                            <div class="flex items-center gap-4 text-sm text-gray-600">
                                <span>By {{ object.created_by.get_display_name }}</span>
                                <span>‚Ä¢</span>
                                <span>{{ object.created_at|date:"F j, Y" }}</span>
                                <span>‚Ä¢</span>
                                <span>{{ object.view_count }} views</span>
                            </div>
                        </div>
                        <div class="badge {% if object.is_visible %}badge-success{% else %}badge-error{% endif %}">
                            {% if object.is_visible %}Active{% else %}Inactive{% endif %}
                        </div>
                    </div>
                    
                    <div class="text-gray-700 mb-4">
                        {{ object.content|truncatewords:30 }}
                    </div>
                    
                    {% if object.target_categories.exists %}
                    <div class="flex flex-wrap gap-2">
                        <span class="text-sm text-gray-500">Categories:</span>
                        {% for category in object.target_categories.all %}
                        <span class="badge badge-outline badge-xs">{{ category.name }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Impact Summary -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="stat bg-gray-50 rounded-lg">
                    <div class="stat-figure text-error">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div class="stat-title">Total Views</div>
                    <div class="stat-value text-error">{{ object.view_count }}</div>
                    <div class="stat-desc">Will be lost</div>
                </div>
                
                <div class="stat bg-gray-50 rounded-lg">
                    <div class="stat-figure text-warning">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div class="stat-title">Categories</div>
                    <div class="stat-value text-warning">{{ object.target_categories.count }}</div>
                    <div class="stat-desc">Affected</div>
                </div>
                
                <div class="stat bg-gray-50 rounded-lg">
                    <div class="stat-figure text-info">
                        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div class="stat-title">Days Active</div>
                    <div class="stat-value text-info">{{ object.created_at|timesince|first_word }}</div>
                    <div class="stat-desc">History lost</div>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="danger-zone">
                <div class="flex items-start gap-4 mb-6">
                    <div class="text-4xl">üö®</div>
                    <div>
                        <h3 class="text-xl font-bold text-red-800 mb-2">Danger Zone</h3>
                        <p class="text-red-700 mb-4">
                            You are about to permanently delete the outreach post 
                            <strong>"{{ object.title }}"</strong>. This action will:
                        </p>
                        <ul class="list-disc list-inside text-red-700 space-y-1 mb-6">
                            <li>Remove the post from all public displays</li>
                            <li>Delete all view statistics and engagement data</li>
                            <li>Remove category associations</li>
                            <li>Delete any scheduled expiration settings</li>
                            <li>Create an audit log entry of this deletion</li>
                        </ul>
                    </div>
                </div>

                <!-- Delete Reason -->
                <form method="post" id="deleteForm">
                    {% csrf_token %}
                    
                    <div class="form-control mb-6">
                        <label class="label">
                            <span class="label-text font-semibold text-red-800">Deletion Reason</span>
                            <span class="label-text-alt text-red-600">Required</span>
                        </label>
                        <textarea name="deletion_reason" 
                                  class="textarea textarea-bordered textarea-error" 
                                  placeholder="Please explain why you are deleting this post..." 
                                  rows="4" 
                                  required></textarea>
                        <label class="label">
                            <span class="label-text-alt text-red-600">
                                This reason will be logged for audit purposes
                            </span>
                        </label>
                    </div>

                    <!-- Confirmation Checkbox -->
                    <div class="form-control mb-6">
                        <label class="label cursor-pointer justify-start gap-3">
                            <input type="checkbox" 
                                   class="checkbox checkbox-error" 
                                   id="confirmDelete" 
                                   required>
                            <span class="label-text font-semibold text-red-800">
                                I understand this action is permanent and cannot be undone
                            </span>
                        </label>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex justify-between items-center pt-6 border-t border-red-300">
                        <div class="flex gap-3">
                            <a href="{% url 'moderators:outreach_detail' object.pk %}" 
                               class="btn btn-outline">
                                Cancel
                            </a>
                            <a href="{% url 'moderators:outreach' %}" 
                               class="btn btn-outline btn-info">
                                Back to All Posts
                            </a>
                        </div>
                        
                        <button type="submit" 
                                class="btn btn-error" 
                                id="deleteButton" 
                                disabled>
                            üóëÔ∏è Delete Post Permanently
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Alternative Actions -->
        <div class="card bg-base-100 shadow-lg mt-8">
            <div class="card-body">
                <h3 class="card-title mb-4">üí° Consider These Alternatives</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <h4 class="font-semibold text-yellow-800 mb-2">Deactivate Instead</h4>
                        <p class="text-yellow-700 text-sm mb-3">
                            Hide the post from public view while preserving all data and statistics.
                        </p>
                        <a href="{% url 'moderators:outreach_edit' object.pk %}" 
                           class="btn btn-warning btn-sm">
                            Edit Post Settings
                        </a>
                    </div>
                    
                    <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-2">Archive Post</h4>
                        <p class="text-blue-700 text-sm mb-3">
                            Mark as expired to keep for reference while removing from active display.
                        </p>
                        <a href="{% url 'moderators:outreach_edit' object.pk %}" 
                           class="btn btn-info btn-sm">
                            Set Expiry Date
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const confirmCheckbox = document.getElementById('confirmDelete');
    const deleteButton = document.getElementById('deleteButton');
    const deleteForm = document.getElementById('deleteForm');
    const reasonTextarea = document.querySelector('textarea[name="deletion_reason"]');
    
    // Enable/disable delete button based on confirmation
    function updateDeleteButton() {
        const isChecked = confirmCheckbox.checked;
        const hasReason = reasonTextarea.value.trim().length >= 10;
        
        deleteButton.disabled = !(isChecked && hasReason);
        
        if (isChecked && hasReason) {
            deleteButton.classList.remove('btn-disabled');
        } else {
            deleteButton.classList.add('btn-disabled');
        }
    }
    
    confirmCheckbox.addEventListener('change', updateDeleteButton);
    reasonTextarea.addEventListener('input', updateDeleteButton);
    
    // Final confirmation on form submit
    deleteForm.addEventListener('submit', function(e) {
        const postTitle = "{{ object.title|escapejs }}";
        const confirmMessage = `Are you absolutely sure you want to delete "${postTitle}"?\n\nThis action CANNOT be undone!`;
        
        if (!confirm(confirmMessage)) {
            e.preventDefault();
            return false;
        }
        
        // Update button to show processing
        deleteButton.innerHTML = 'üóëÔ∏è Deleting...';
        deleteButton.disabled = true;
    });
    
    // Auto-resize textarea
    reasonTextarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });
});

// Add template literal filter for getting first word (if not already defined)
if (!String.prototype.first_word) {
    String.prototype.first_word = function() {
        return this.split(' ')[0];
    };
}
</script>
{% endblock %} 